# namespace 생성
kubectl create namespace floweryroad

# secret 생성
kubectl create secret generic app --from-env-file=.envs/staging/app.env -n floweryroad
kubectl create secret generic auth --from-env-file=.envs/staging/auth.env -n floweryroad

# secret 제거
kubectl delete secret app -n floweryroad
kubectl delete secret auth -n floweryroad

# image 레지스트리에 푸시
docker push lunacircle4/app.floweryroad:1.0.0

# appling
export TAG=1.0.0
envsubst < app.yaml | kubectl apply -f - -n floweryroad

# deployment 제거
envsubst < app.yaml | kubectl delete -f - -n floweryroad

# pod 로깅 및 상태 확인
kubectl get pods -n floweryroad
kubectl describe deployment app -n floweryroad
kubectl describe pod app-77bfd5df59-lx6m4 -n floweryroad
kubectl logs app-77bfd5df59-lx6m4 -n floweryroad

# pod 내에 접속
kubectl exec -it app-77bfd5df59-lx6m4 bash -n floweryroad

# ingress 컨트롤러 설치
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.48.1/deploy/static/provider/cloud/deploy.yaml

# ingress 적용
kubectl apply -f ingress.yaml -n floweryroad
